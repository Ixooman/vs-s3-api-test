# Система проверки совместимости с S3 API

Комплексная платформа для тестирования совместимости пользовательских систем хранения с Amazon S3 API. Инструмент помогает разработчикам и системным администраторам проверить корректность реализации S3-совместимых хранилищ.

Платформа включает как современный Python-фреймворк для тестирования, так и классические скрипты AWS CLI для комплексной валидации S3 API.

## Возможности

- **Полное тестирование**: Проверка всех основных операций S3 включая бакеты, объекты, многочастные загрузки, версионирование и теги
- **Тестирование диапазонных запросов**: Проверка частичного получения объектов с использованием HTTP Range заголовков
- **Тестирование ошибок**: Проверка корректной обработки некорректных запросов и граничных случаев
- **Расширяемая архитектура**: Простое добавление новых категорий тестов
- **Детальная отчетность**: Вывод в консоль и логирование в файл с настраиваемым уровнем детализации
- **Протокольное логирование**: Raw HTTP запросы/ответы для максимальной валидации S3 API
- **Отладка boto3**: Полное отладочное логирование AWS SDK для анализа на уровне протокола
- **Конфигурация через INI**: Простая настройка через конфигурационные файлы
- **Автоматическая очистка**: Автоматическое удаление тестовых ресурсов

## Python Фреймворк: Категории тестов

### Базовые операции
- **buckets**: Создание, перечисление, удаление бакетов, конфигурация
- **objects**: Загрузка, скачивание, копирование, удаление объектов, метаданные
- **multipart**: Многочастные загрузки (создание, загрузка частей, завершение, отмена)

### Расширенные функции
- **versioning**: Версионирование объектов (включение/отключение, работа с версиями)
- **tagging**: Теги бакетов и объектов (установка, получение, удаление)
- **attributes**: Атрибуты объектов и метаданные
- **metadata**: Полное тестирование метаданных (стандартные заголовки, пользовательские метаданные, кодировка)

### Специализированное тестирование
- **range_requests**: Частичное получение объектов с HTTP Range заголовками
- **error_conditions**: Обработка ошибок для некорректных запросов
- **sync**: Пакетные операции и синхронизация директорий

## Скрипты тестирования AWS CLI

Помимо Python фреймворка, проект включает специализированные скрипты AWS CLI для специфических сценариев тестирования S3:

### Классический набор тестов AWS CLI
- **S3_compatibility.txt**: Исходный комплексный скрипт AWS CLI с последовательными операциями, охватывающими операции с бакетами, управление жизненным циклом объектов, многочастные загрузки, версионирование, теги и атрибуты объектов

### Продвинутое тестирование многочастных загрузок

#### `scripts/max_object_multipart_probe.sh`
Комплексное тестирование многочастных загрузок больших объектов с динамическим размером частей:
- Тестирование объектов от 100MB до нескольких терабайт
- Динамический размер частей: 64MB (< 1GB), 128MB (< 10GB), 256MB (< 100GB), 512MB (< 1TB), 1024MB (< 5TB), 2048MB (≥ 5TB)
- Поддержка диапазонов размеров объектов с шагом
- Полный вывод отладки и подробный отчет о ходе работы
- Автоматическая очистка тестовых объектов

```bash
# Тестирование многочастных загрузок объектов от 100MB до 1GB с шагом 100MB
scripts/max_object_multipart_probe.sh --bucket test-bucket --min 100mb --max 1gb --step 100mb --debug

# Тестирование с очисткой
scripts/max_object_multipart_probe.sh --bucket test-bucket --min 500mb --max 5gb --step 500mb --cleanup
```

#### `scripts/multipart_upload_check.sh`
Проверка многочастной загрузки одного объекта с валидацией контрольной суммы:
- Создание и загрузка одного объекта с использованием многочастной загрузки
- Проверка корректности загрузки в двух режимах верификации:
  - **Гибридный режим (по умолчанию)**: Быстрая верификация сравнением исходного MD5 с ETag S3 (без скачивания)
  - **Полная верификация**: Скачивание объекта и валидация соответствия MD5 с исходными данными (полная проверка сквозного процесса)
- Опциональная автоматическая очистка
- Гибкая конфигурация размера частей

```bash
# Загрузка объекта 500MB с частями 64MB (гибридная верификация)
scripts/multipart_upload_check.sh --bucket test-bucket --size 500mb --part 64mb

# Полный режим верификации с очисткой
scripts/multipart_upload_check.sh --bucket test-bucket --size 1gb --part 128mb --verify-full --cleanup

# Режим отладки для просмотра всех команд AWS CLI
scripts/multipart_upload_check.sh --bucket test-bucket --size 100mb --part 64mb --debug
```

### Требования к скриптам
- Установленный и сконфигурированный AWS CLI
- Доступ к S3-совместимому endpoint с действительными учетными данными
- Достаточно свободного места в хранилище для тестовых объектов
- Сетевое подключение к S3 endpoint

## Быстрый старт (Python Фреймворк)

### 1. Установка зависимостей
```bash
pip install -r requirements.txt
```

### 2. Создание конфигурации
```bash
python main.py --generate-config
# Отредактируйте config.ini с параметрами вашего S3 endpoint
```

### 3. Запуск проверок
```bash
# Запуск всех проверок совместимости
python main.py --scope all

# Запуск конкретных категорий
python main.py --scope buckets,objects,multipart --log-level debug
```

## Поддержка

Инструмент предназначен для тестовых сред. Проверьте, что ваша S3-реализация соответствует стандартным конвенциям S3 API для корректной работы всех функций.

Для подробной документации по Python фреймворку см. README.md